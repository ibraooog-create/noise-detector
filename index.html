<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø±Ø§Ù‚Ø¨ Ù‡Ø¯ÙˆØ¡ Ø§Ù„ÙØµÙ„</title>
    <style>
        body { background-color: #f0f4f8; transition: background 0.3s ease; margin: 0; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        #main-card { background: white; padding: 30px; border-radius: 25px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); text-align: center; width: 90%; max-width: 500px; }
        
        .classroom-header { color: #2d3748; margin-bottom: 20px; }
        .classroom-header h2 { margin: 0; font-size: 24px; }
        
        #counter-display { background: #ebf8ff; padding: 15px; border-radius: 15px; border: 2px solid #bee3f8; margin-bottom: 20px; }
        #alert-count { font-size: 3rem; color: #2b6cb0; font-weight: bold; }
        
        .meter-container { background: #edf2f7; border-radius: 20px; height: 35px; overflow: hidden; border: 2px solid #e2e8f0; margin: 20px 0; }
        #progress-bar { width: 0%; height: 100%; background: linear-gradient(to left, #48bb78, #ecc94b, #f56565); transition: width 0.1s; }
        
        #emoji-box { font-size: 100px; margin: 20px 0; transition: transform 0.2s; }
        #status-msg { font-size: 1.5rem; font-weight: bold; margin-bottom: 20px; }
        
        .controls { display: flex; gap: 10px; flex-direction: column; }
        button { padding: 15px; border: none; border-radius: 15px; cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.2s; }
        #start-btn { background: #48bb78; color: white; }
        .reset-btn { background: #a0aec0; color: white; }
    </style>
</head>
<body>

<div id="main-card">
    <div class="classroom-header">
        <h2>ğŸ”‡ Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù„Ù‡Ø¯ÙˆØ¡ Ø§Ù„Ø°ÙƒÙŠ</h2>
        <p>Ø­Ø§ÙØ¸ÙˆØ§ Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø¯ÙˆØ¡ Ù„ÙŠØ¨Ù‚Ù‰ Ø§Ù„Ø¹Ø¯Ø§Ø¯ ØµÙØ±Ø§Ù‹!</p>
    </div>

    <div id="counter-display">
        <div>Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø¶Ø¬ÙŠØ¬:</div>
        <div id="alert-count">0</div>
    </div>

    <div id="emoji-box">ğŸ¤</div>
    <div id="status-msg">Ø§Ø¶ØºØ· Ù„Ù„Ø¨Ø¯Ø¡</div>

    <div class="meter-container">
        <div id="progress-bar"></div>
    </div>

    <div class="controls">
        <button id="start-btn">Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙÙŠ Ø§Ù„ÙØµÙ„</button>
        <button class="reset-btn" onclick="resetAll()">ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯</button>
    </div>
</div>

<script>
let audioCtx, analyser, isBeeping = false;
let count = 0;
let canAdd = true;

const startBtn = document.getElementById('start-btn');
const progressBar = document.getElementById('progress-bar');
const statusMsg = document.getElementById('status-msg');
const emojiBox = document.getElementById('emoji-box');
const alertDisplay = document.getElementById('alert-count');

function resetAll() {
    count = 0;
    alertDisplay.innerText = count;
    document.body.style.backgroundColor = "#f0f4f8";
}

function triggerAlert() {
    if (isBeeping || !audioCtx) return;
    isBeeping = true;
    
    // ØµÙˆØª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
    const osc = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    osc.type = 'sine';
    osc.frequency.setValueAtTime(500, audioCtx.currentTime);
    g.gain.setValueAtTime(0.1, audioCtx.currentTime);
    osc.connect(g);
    g.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 0.4);

    // ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø¨ØµØ±ÙŠ
    document.body.style.backgroundColor = "#fff5f5";
    setTimeout(() => { document.body.style.backgroundColor = "#f0f4f8"; }, 1000);

    if (canAdd) {
        count++;
        alertDisplay.innerText = count;
        canAdd = false;
        setTimeout(() => { canAdd = true; }, 2000); // Ù…Ù‡Ù„Ø© Ø«Ø§Ù†ÙŠØªÙŠÙ† Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ø¯ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
    }
    setTimeout(() => { isBeeping = false; }, 1000);
}

startBtn.onclick = function() {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
        startBtn.style.display = 'none';
        analyser = audioCtx.createAnalyser();
        const source = audioCtx.createMediaStreamSource(stream);
        const proc = audioCtx.createScriptProcessor(2048, 1, 1);
        analyser.fftSize = 512;
        source.connect(analyser);
        proc.connect(audioCtx.destination);

        proc.onaudioprocess = () => {
            const data = new Uint8Array(analyser.frequencyBinCount);
            analyser.getByteFrequencyData(data);
            let sum = 0;
            data.forEach(v => sum += v);
            const avg = sum / data.length;
            
            // Ø­Ø³Ø§Ø³ÙŠØ© Ù…Ø®ØµØµØ© Ù„Ù„ÙØµÙˆÙ„ (ØªØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù‡Ù…Ø³ Ø§Ù„Ø¨Ø³ÙŠØ·)
            const vol = Math.min(Math.max(0, (avg - 3) * 1.8), 100);
            progressBar.style.width = vol + '%';

            if (vol <= 25) {
                statusMsg.innerText = "ÙØµÙ„ Ø±Ø§Ø¦Ø¹ ÙˆÙ‡Ø§Ø¯Ø¦ ğŸ¤©";
                statusMsg.style.color = "#48bb78";
                emojiBox.innerText = "ğŸ¤©";
                emojiBox.style.transform = "scale(1)";
            } else if (vol <= 80) {
                statusMsg.innerText = "Ø§Ù†ØªØ¨Ù‡ÙˆØ§.. Ø§Ù„ØµÙˆØª ÙŠØ±ØªÙØ¹! ğŸ˜";
                statusMsg.style.color = "#d69e2e";
                emojiBox.innerText = "ğŸ˜";
                emojiBox.style.transform = "scale(1.1)";
            } else {
                statusMsg.innerText = "ØµÙˆØª Ù…Ø±ØªÙØ¹ Ø¬Ø¯Ø§Ù‹! ğŸš¨";
                statusMsg.style.color = "#e53e3e";
                emojiBox.innerText = "ğŸ˜«";
                emojiBox.style.transform = "scale(1.3)";
                triggerAlert();
            }
        };
    });
};
</script>
</body>
</html>
