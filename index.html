<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø±Ø§Ù‚Ø¨ Ù‡Ø¯ÙˆØ¡ Ø§Ù„ÙØµÙ„ - Ù†Ø³Ø®Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
    <style>
        body { background-color: #f0f4f8; transition: background 0.3s ease; margin: 0; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        #main-card { background: white; padding: 25px; border-radius: 25px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); text-align: center; width: 90%; max-width: 480px; }
        
        /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© */
        .config-panel { background: #f8fafc; padding: 15px; border-radius: 15px; border: 1px solid #e2e8f0; margin-bottom: 15px; }
        .slider { width: 100%; cursor: pointer; margin: 10px 0; }
        .config-label { font-size: 14px; color: #4a5568; font-weight: bold; }

        #counter-display { background: #ebf8ff; padding: 10px; border-radius: 15px; border: 2px solid #bee3f8; margin-bottom: 15px; }
        #alert-count { font-size: 3.5rem; color: #2b6cb0; font-weight: bold; line-height: 1; margin: 5px 0; }
        
        .meter-container { background: #edf2f7; border-radius: 20px; height: 30px; overflow: hidden; border: 1px solid #e2e8f0; margin: 15px 0; }
        #progress-bar { width: 0%; height: 100%; background: linear-gradient(to left, #48bb78, #ecc94b, #f56565); transition: width 0.1s; }
        
        #emoji-box { font-size: 90px; margin: 10px 0; transition: transform 0.2s; }
        #status-msg { font-size: 1.3rem; font-weight: bold; margin-bottom: 15px; }
        
        .btn-group { display: flex; gap: 10px; flex-direction: column; }
        button { padding: 12px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.2s; }
        #start-btn { background: #48bb78; color: white; }
        .reset-btn { background: #a0aec0; color: white; font-size: 13px; padding: 8px; }
    </style>
</head>
<body>

<div id="main-card">
    <div class="classroom-header">
        <h3 style="margin: 0 0 15px 0; color: #2d3748;">ğŸ”‡ Ù…Ø±Ø§Ù‚Ø¨ ØµÙˆØª Ø§Ù„ÙØµÙ„</h3>
    </div>

    <div class="config-panel">
        <div class="config-label">Ø¹ÙŠÙ‘Ø§Ø± Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ©: <span id="sens-val" style="color:#2b6cb0">1.8</span></div>
        <input type="range" id="sens-slider" class="slider" min="0.5" max="5.0" step="0.1" value="1.8">
        <div style="font-size: 11px; color: #718096;">(Ù‚Ù„Ù„ Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙØµÙ„ Ù…Ø³Ù…ÙˆØ­Ø§Ù‹ ÙÙŠÙ‡ Ø¨Ø§Ù„ÙƒÙ„Ø§Ù… Ø§Ù„Ø®ÙÙŠÙ)</div>
    </div>

    <div id="counter-display">
        <div style="font-size: 14px;">Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù‡Ø¯ÙˆØ¡:</div>
        <div id="alert-count">0</div>
        <button class="reset-btn" onclick="resetAll()">ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯</button>
    </div>

    <div id="emoji-box">ğŸ¤</div>
    <div id="status-msg">Ø§Ø¶ØºØ· Ù„Ù„Ø¨Ø¯Ø¡</div>

    <div class="meter-container">
        <div id="progress-bar"></div>
    </div>

    <button id="start-btn">Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</button>
</div>

<script>
let audioCtx, analyser, isBeeping = false;
let count = 0;
let canAdd = true;
let sensitivity = 1.8;

const startBtn = document.getElementById('start-btn');
const progressBar = document.getElementById('progress-bar');
const statusMsg = document.getElementById('status-msg');
const emojiBox = document.getElementById('emoji-box');
const alertDisplay = document.getElementById('alert-count');
const sensSlider = document.getElementById('sens-slider');
const sensVal = document.getElementById('sens-val');

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© Ù„Ø­Ø¸ÙŠØ§Ù‹
sensSlider.oninput = function() {
    sensitivity = parseFloat(this.value);
    sensVal.innerText = sensitivity;
}

function resetAll() {
    count = 0;
    alertDisplay.innerText = count;
    document.body.style.backgroundColor = "#f0f4f8";
}

function triggerAlert() {
    if (isBeeping || !audioCtx) return;
    isBeeping = true;
    
    // ØªÙ†Ø¨ÙŠÙ‡ ØµÙˆØªÙŠ
    const osc = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    osc.type = 'sine';
    osc.frequency.setValueAtTime(500, audioCtx.currentTime);
    g.gain.setValueAtTime(0.1, audioCtx.currentTime);
    osc.connect(g);
    g.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 0.4);

    // ÙÙ„Ø§Ø´ Ø£Ø­Ù…Ø± Ù„Ù„Ø®Ù„ÙÙŠØ©
    document.body.style.backgroundColor = "#fed7d7";
    setTimeout(() => { document.body.style.backgroundColor = "#f0f4f8"; }, 1000);

    if (canAdd) {
        count++;
        alertDisplay.innerText = count;
        canAdd = false;
        setTimeout(() => { canAdd = true; }, 2000);
    }
    setTimeout(() => { isBeeping = false; }, 1000);
}

startBtn.onclick = function() {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
        startBtn.style.display = 'none';
        analyser = audioCtx.createAnalyser();
        const source = audioCtx.createMediaStreamSource(stream);
        const proc = audioCtx.createScriptProcessor(2048, 1, 1);
        analyser.fftSize = 512;
        source.connect(analyser);
        proc.connect(audioCtx.destination);

        proc.onaudioprocess = () => {
            const data = new Uint8Array(analyser.frequencyBinCount);
            analyser.getByteFrequencyData(data);
            let sum = 0;
            data.forEach(v => sum += v);
            const avg = sum / data.length;
            
            // Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
            const vol = Math.min(Math.max(0, (avg - 2) * sensitivity), 100);
            progressBar.style.width = vol + '%';

            if (vol <= 25) {
                statusMsg.innerText = "ÙØµÙ„ Ù‡Ø§Ø¯Ø¦ ÙˆÙ…Ø«Ø§Ù„ÙŠ ğŸ¤©";
                statusMsg.style.color = "#48bb78";
                emojiBox.innerText = "ğŸ¤©";
                emojiBox.style.transform = "scale(1)";
            } else if (vol <= 80) {
                statusMsg.innerText = "Ù‡Ø¯ÙˆØ¡ ÙŠØ§ Ø£Ø¨Ø·Ø§Ù„.. ğŸ˜";
                statusMsg.style.color = "#d69e2e";
                emojiBox.innerText = "ğŸ˜";
                emojiBox.style.transform = "scale(1.1)";
            } else {
                statusMsg.innerText = "Ø¶Ø¬ÙŠØ¬ ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­! ğŸš¨";
                statusMsg.style.color = "#e53e3e";
                emojiBox.innerText = "ğŸ˜«";
                emojiBox.style.transform = "scale(1.3)";
                triggerAlert();
            }
        };
    });
};
</script>
</body>
</html>
